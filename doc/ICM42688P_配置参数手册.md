# ICM-42688-P 可配置参数完整参考手册

本文档整理了ICM-42688-P IMU传感器的所有可配置功能和参数,供开发时快速查阅。

---

## 目录
1. [电源管理与工作模式](#1-电源管理与工作模式)
2. [陀螺仪配置](#2-陀螺仪配置)
3. [加速度计配置](#3-加速度计配置)
4. [数字滤波器配置](#4-数字滤波器配置)
5. [FIFO配置](#5-fifo配置)
6. [中断配置](#6-中断配置)
7. [APEX运动功能](#7-apex运动功能)
8. [接口配置](#8-接口配置)
9. [时钟配置](#9-时钟配置)
10. [温度传感器配置](#10-温度传感器配置)
11. [用户偏移量配置](#11-用户偏移量配置)
12. [自检配置](#12-自检配置)
13. [FSYNC配置](#13-fsync配置)
14. [时间戳配置](#14-时间戳配置)

---

## 1. 电源管理与工作模式

### 1.1 标准电源模式 (PWR_MGMT0, Bank0, 0x4E)

#### 陀螺仪模式 (GYRO_MODE, bits 3:2)
**功能说明**: 控制陀螺仪的工作状态

**可选值**:
- `00`: 关闭陀螺仪 (默认)
- `01`: 待机模式 (Standby Mode) - 陀螺仪驱动开启但不输出数据
- `10`: 保留
- `11`: 低噪声模式 (Low Noise Mode) - 正常工作模式

**效果说明**:
- OFF模式: 陀螺仪完全关闭,功耗最低
- 待机模式: 保持陀螺仪驱动运行,快速切换到LN模式
- 低噪声模式: 正常工作,噪声最低(2.8 mdps/√Hz),功耗0.73mA
- **注意**: 陀螺仪需保持开启至少45ms;从OFF切换到其他模式后,200μs内不要进行寄存器写操作

#### 加速度计模式 (ACCEL_MODE, bits 1:0)
**功能说明**: 控制加速度计的工作状态

**可选值**:
- `00`: 关闭加速度计 (默认)
- `01`: 关闭加速度计
- `10`: 低功耗模式 (Low Power Mode)
- `11`: 低噪声模式 (Low Noise Mode)

**效果说明**:
- OFF模式: 加速度计完全关闭
- 低功耗模式: 占空比工作,功耗低,支持ODR≤500Hz
- 低噪声模式: 连续工作,噪声最低(65-70 μg/√Hz),功耗0.28mA
- **注意**: 从OFF切换到其他模式后,200μs内不要进行寄存器写操作

#### 温度传感器使能 (TEMP_DIS, bit 5)
**功能说明**: 控制温度传感器开关

**可选值**:
- `0`: 温度传感器使能 (默认)
- `1`: 温度传感器禁用

**效果说明**:
- 使能时自动测量芯片温度
- 禁用可节省少量功耗

#### IDLE模式 (IDLE, bit 4)
**功能说明**: 控制RC振荡器在传感器关闭时是否保持开启

**可选值**:
- `0`: 传感器关闭时,RC振荡器也关闭 (默认,进入OFF状态)
- `1`: 传感器关闭时,RC振荡器保持开启

**效果说明**:
- 设为1可加快唤醒速度,但功耗略高

### 1.2 标准功耗模式总结

| 模式 | 陀螺仪 | 加速度计 | 功耗 |
|------|--------|----------|------|
| Sleep Mode | OFF | OFF | 7.5μA |
| Standby Mode | Drive On | OFF | - |
| Accel LP Mode | OFF | Duty-Cycled | 低 |
| Accel LN Mode | OFF | ON | 0.28mA |
| Gyro LN Mode | ON | OFF | 0.73mA |
| 6-Axis LN Mode | ON | ON | 0.88mA |

---

## 2. 陀螺仪配置

### 2.1 陀螺仪满量程范围 (GYRO_CONFIG0, Bank0, 0x4F)

#### GYRO_FS_SEL (bits 7:5)
**功能说明**: 设置陀螺仪的测量范围

**可选值与灵敏度**:
| GYRO_FS_SEL | 满量程范围 | 灵敏度 (LSB/(°/s)) |
|-------------|-----------|-------------------|
| `000` | ±2000 dps | 16.4 (默认) |
| `001` | ±1000 dps | 32.8 |
| `010` | ±500 dps | 65.5 |
| `011` | ±250 dps | 131 |
| `100` | ±125 dps | 262 |
| `101` | ±62.5 dps | 524.3 |
| `110` | ±31.25 dps | 1048.6 |
| `111` | ±15.625 dps | 2097.2 |

**效果说明**:
- 量程越小,分辨率越高,适合测量慢速旋转
- 量程越大,可测量的最大角速度越大
- 20位FIFO模式下仅支持±2000dps,灵敏度131 LSB/(°/s)

**选择建议**:
- 普通应用: ±2000 dps
- 精密测量/慢速旋转: ±250 dps或更小
- 高速旋转: ±2000 dps

### 2.2 陀螺仪输出数据率 (GYRO_CONFIG0, Bank0, 0x4F)

#### GYRO_ODR (bits 3:0)
**功能说明**: 设置陀螺仪数据输出频率

**可选值**:
| GYRO_ODR | ODR值 | 适用场景 |
|----------|-------|---------|
| `0000` | 保留 | - |
| `0001` | 32 kHz | 高速采样 |
| `0010` | 16 kHz | 高速采样 |
| `0011` | 8 kHz | 高速采样 |
| `0100` | 4 kHz | 高速采样 |
| `0101` | 2 kHz | 一般高速 |
| `0110` | 1 kHz | 标准 (默认) |
| `0111` | 200 Hz | 低速 |
| `1000` | 100 Hz | 低速 |
| `1001` | 50 Hz | 低功耗 |
| `1010` | 25 Hz | 低功耗 |
| `1011` | 12.5 Hz | 超低功耗 |
| `1100` | 保留 | - |
| `1101` | 保留 | - |
| `1110` | 保留 | - |
| `1111` | 500 Hz | 常用 |

**效果说明**:
- ODR越高,数据更新越快,但功耗和数据量增大
- ODR越低,功耗越低,但响应延迟增加
- 使用外部时钟时,实际ODR会随外部时钟频率缩放

**选择建议**:
- 高速运动控制: 1-8 kHz
- 一般姿态检测: 200-1000 Hz
- 低功耗应用: 25-100 Hz

---

## 3. 加速度计配置

### 3.1 加速度计满量程范围 (ACCEL_CONFIG0, Bank0, 0x50)

#### ACCEL_FS_SEL (bits 7:5)
**功能说明**: 设置加速度计的测量范围

**可选值与灵敏度**:
| ACCEL_FS_SEL | 满量程范围 | 灵敏度 (LSB/g) |
|--------------|-----------|---------------|
| `000` | ±16 g | 2,048 (默认) |
| `001` | ±8 g | 4,096 |
| `010` | ±4 g | 8,192 |
| `011` | ±2 g | 16,384 |
| `100` | 保留 | - |
| `101` | 保留 | - |
| `110` | 保留 | - |
| `111` | 保留 | - |

**效果说明**:
- 量程越小,分辨率越高,适合测量小加速度
- 量程越大,可测量的最大加速度越大
- 20位FIFO模式下仅支持±16g,灵敏度8192 LSB/g

**选择建议**:
- 震动/冲击检测: ±16 g
- 姿态检测: ±2 g或±4 g
- 精密倾角测量: ±2 g

### 3.2 加速度计输出数据率 (ACCEL_CONFIG0, Bank0, 0x50)

#### ACCEL_ODR (bits 3:0)
**功能说明**: 设置加速度计数据输出频率

**可选值**:
| ACCEL_ODR | ODR值 | 支持模式 |
|-----------|-------|---------|
| `0000` | 保留 | - |
| `0001` | 32 kHz | 仅LN模式 |
| `0010` | 16 kHz | 仅LN模式 |
| `0011` | 8 kHz | 仅LN模式 |
| `0100` | 4 kHz | 仅LN模式 |
| `0101` | 2 kHz | 仅LN模式 |
| `0110` | 1 kHz | 仅LN模式 (默认) |
| `0111` | 200 Hz | LP或LN模式 |
| `1000` | 100 Hz | LP或LN模式 |
| `1001` | 50 Hz | LP或LN模式 |
| `1010` | 25 Hz | LP或LN模式 |
| `1011` | 12.5 Hz | LP或LN模式 |
| `1100` | 6.25 Hz | 仅LP模式 |
| `1101` | 3.125 Hz | 仅LP模式 |
| `1110` | 1.5625 Hz | 仅LP模式 |
| `1111` | 500 Hz | LP或LN模式 |

**效果说明**:
- LN模式支持最高32kHz,适合高速应用
- LP模式支持最低1.5625Hz,功耗最低
- LP模式最高500Hz
- 不同ODR影响滤波器配置

**注意事项**:
- LN模式不支持低于12.5Hz的ODR
- LP模式不支持高于500Hz的ODR
- 模式切换时需调整ODR到支持范围

---

## 4. 数字滤波器配置

### 4.1 陀螺仪UI滤波器

#### 4.1.1 滤波器阶数 (GYRO_CONFIG1, Bank0, 0x51)

##### GYRO_UI_FILT_ORD (bits 3:2)
**功能说明**: 设置陀螺仪UI路径滤波器的阶数

**可选值**:
| 设置值 | 滤波器阶数 |
|-------|-----------|
| `00` | 1阶 |
| `01` | 2阶 |
| `10` | 3阶 |
| `11` | 保留 |

**效果说明**:
- 1阶: 最小延迟,噪声抑制弱
- 2阶: 平衡延迟和噪声抑制
- 3阶: 最强噪声抑制,延迟最大

#### 4.1.2 滤波器带宽 (GYRO_ACCEL_CONFIG0, Bank0, 0x52)

##### GYRO_UI_FILT_BW (bits 3:0)
**功能说明**: 设置陀螺仪UI滤波器的3dB带宽

**可选值** (LN模式):
| 设置值 | 带宽计算 | 说明 |
|-------|---------|------|
| `0` | BW=ODR/2 | |
| `1` | BW=max(400Hz,ODR)/4 | 默认 |
| `2` | BW=max(400Hz,ODR)/5 | |
| `3` | BW=max(400Hz,ODR)/8 | |
| `4` | BW=max(400Hz,ODR)/10 | |
| `5` | BW=max(400Hz,ODR)/16 | |
| `6` | BW=max(400Hz,ODR)/20 | |
| `7` | BW=max(400Hz,ODR)/40 | |
| `8-13` | 保留 | |
| `14` | 低延迟选项 | Dec2@max(400Hz,ODR) |
| `15` | 低延迟选项 | Dec2@max(200Hz,8*ODR) |

**效果说明**:
- 带宽越小,噪声抑制越好,但延迟增加
- 带宽越大,响应越快,但噪声增加
- 详细的3dB带宽、噪声带宽和群延迟见datasheet表格5.5节

### 4.2 加速度计UI滤波器

#### 4.2.1 滤波器阶数 (ACCEL_CONFIG1, Bank0, 0x53)

##### ACCEL_UI_FILT_ORD (bits 4:3)
**功能说明**: 设置加速度计UI路径滤波器的阶数

**可选值**:
| 设置值 | 滤波器阶数 |
|-------|-----------|
| `00` | 1阶 |
| `01` | 2阶 |
| `10` | 3阶 |
| `11` | 保留 |

#### 4.2.2 滤波器带宽 (GYRO_ACCEL_CONFIG0, Bank0, 0x52)

##### ACCEL_UI_FILT_BW (bits 7:4)
**功能说明**: 设置加速度计UI滤波器的3dB带宽

**LN模式可选值**:
| 设置值 | 带宽计算 | 说明 |
|-------|---------|------|
| `0` | BW=ODR/2 | |
| `1` | BW=max(400Hz,ODR)/4 | 默认 |
| `2` | BW=max(400Hz,ODR)/5 | |
| `3` | BW=max(400Hz,ODR)/8 | |
| `4` | BW=max(400Hz,ODR)/10 | |
| `5` | BW=max(400Hz,ODR)/16 | |
| `6` | BW=max(400Hz,ODR)/20 | |
| `7` | BW=max(400Hz,ODR)/40 | |
| `8-13` | 保留 | |
| `14` | 低延迟选项 | Dec2@max(400Hz,ODR) |
| `15` | 低延迟选项 | Dec2@max(200Hz,8*ODR) |

**LP模式可选值**:
| 设置值 | 平均滤波倍数 |
|-------|------------|
| `0` | 保留 |
| `1` | 1x平均 (默认) |
| `2-5` | 保留 |
| `6` | 16x平均 |
| `7-15` | 保留 |

**效果说明**:
- LP模式建议使用16x平均以满足Android噪声要求
- LP模式仅支持1x和16x两种设置

### 4.3 抗混叠滤波器(AAF)

#### 4.3.1 陀螺仪AAF (Bank1寄存器)

##### GYRO_AAF_DIS (Bank1, 0x0B, bit 1)
**功能说明**: 陀螺仪抗混叠滤波器使能控制

**可选值**:
- `0`: 使能AAF (默认)
- `1`: 禁用AAF

##### GYRO_AAF配置参数
**位置**: Bank1, 0x0C-0x0E

**功能说明**: 配置陀螺仪AAF的带宽,支持42Hz-3979Hz

**配置方法**: 根据datasheet表5.3选择对应的DELT、DELTSQR、BITSHIFT值

**常用带宽配置示例**:
| 3dB带宽 | DELT | DELTSQR | BITSHIFT |
|---------|------|---------|----------|
| 42 Hz | 1 | 1 | 15 |
| 258 Hz | 6 | 36 | 10 |
| 536 Hz | 12 | 144 | 8 |
| 1051 Hz | 22 | 488 | 6 |
| 3979 Hz | 63 | 3968 | 3 |

#### 4.3.2 加速度计AAF (Bank2寄存器)

##### ACCEL_AAF_DIS (Bank2, 0x03, bit 0)
**功能说明**: 加速度计抗混叠滤波器使能控制

**可选值**:
- `0`: 使能AAF (默认)
- `1`: 禁用AAF

##### ACCEL_AAF配置参数
**位置**: Bank2, 0x03-0x05

**功能说明**: 配置加速度计AAF的带宽,同样支持42Hz-3979Hz

**注意**: AAF仅在LN模式下支持

### 4.4 陀螺仪陷波滤波器(Notch Filter)

#### GYRO_NF_DIS (Bank1, 0x0B, bit 0)
**功能说明**: 陀螺仪陷波滤波器使能控制

**可选值**:
- `0`: 使能陷波滤波器 (默认)
- `1`: 禁用陷波滤波器

#### 陷波滤波器频率配置
**位置**: Bank1, 0x0F-0x12

**功能说明**: 用于抑制陀螺仪机械谐振峰的噪声,每个轴独立配置

**频率范围**: 1kHz - 3kHz

**带宽选择** (GYRO_NF_BW_SEL, Bank1, 0x13, bits 6:4):
| 设置值 | 陷波带宽 |
|-------|---------|
| `0` | 1449 Hz |
| `1` | 680 Hz |
| `2` | 329 Hz |
| `3` | 162 Hz |
| `4` | 80 Hz |
| `5` | 40 Hz |
| `6` | 20 Hz |
| `7` | 10 Hz |

**效果说明**:
- 工厂已针对每个轴的谐振频率进行校准
- 可选择陷波宽度,更窄的陷波对其他频率影响更小
- 仅在LN模式下支持

### 4.5 温度传感器滤波器

#### TEMP_FILT_BW (GYRO_CONFIG1, Bank0, 0x51, bits 7:5)
**功能说明**: 设置温度传感器的数字低通滤波器带宽

**可选值**:
| 设置值 | 滤波器带宽 | 延迟 |
|-------|-----------|------|
| `000` | 4000 Hz | 0.125 ms (默认) |
| `001` | 170 Hz | 1 ms |
| `010` | 82 Hz | 2 ms |
| `011` | 40 Hz | 4 ms |
| `100` | 20 Hz | 8 ms |
| `101` | 10 Hz | 16 ms |
| `110` | 5 Hz | 32 ms |
| `111` | 5 Hz | 32 ms |

**效果说明**:
- 带宽越小,温度读数越平滑,但响应越慢
- 温度变化通常较慢,可使用较小带宽

---

## 5. FIFO配置

### 5.1 FIFO模式 (FIFO_CONFIG, Bank0, 0x16)

#### FIFO_MODE (bits 7:6)
**功能说明**: 设置FIFO的工作模式

**可选值**:
| 设置值 | 模式 | 说明 |
|-------|------|------|
| `00` | Bypass模式 | 不使用FIFO,数据直接到寄存器 (默认) |
| `01` | Stream-to-FIFO模式 | 连续写入FIFO,满后覆盖旧数据 |
| `10` | STOP-on-FULL模式 | FIFO满后停止写入 |
| `11` | STOP-on-FULL模式 | 同10 |

**效果说明**:
- Bypass: 实时读取,无缓存
- Stream-to-FIFO: 循环缓存,适合连续采集
- STOP-on-FULL: 保证不丢失数据,满后需及时读取

### 5.2 FIFO内容配置 (FIFO_CONFIG1, Bank0, 0x5F)

#### FIFO_GYRO_EN (bit 1)
**功能说明**: 使能陀螺仪数据写入FIFO

**可选值**:
- `0`: 陀螺仪数据不写入FIFO (默认)
- `1`: 陀螺仪数据写入FIFO (6字节/样本)

#### FIFO_ACCEL_EN (bit 0)
**功能说明**: 使能加速度计数据写入FIFO

**可选值**:
- `0`: 加速度计数据不写入FIFO (默认)
- `1`: 加速度计数据写入FIFO (6字节/样本)

#### FIFO_TEMP_EN (bit 2)
**功能说明**: 使能温度数据写入FIFO

**可选值**:
- `0`: 温度数据不写入FIFO
- `1`: 温度数据写入FIFO (1字节/样本)

#### FIFO_TMST_FSYNC_EN (bit 3)
**功能说明**: 使能时间戳和FSYNC数据写入FIFO

**可选值**:
- `0`: 仅包含ODR时间戳
- `1`: 可包含FSYNC时间和标志

**效果说明**: 使用FSYNC时必须设置为1

#### FIFO_HIRES_EN (bit 4)
**功能说明**: 使能20位高分辨率数据格式

**可选值**:
- `0`: 使用16位数据格式 (默认)
- `1`: 使用20位数据格式 (陀螺19位+加速18位)

**效果说明**:
- 20位模式仅支持±2000dps和±16g
- 包大小变为20字节
- 提供更高的数据精度

#### FIFO_RESUME_PARTIAL_RD (bit 6)
**功能说明**: 允许部分读取FIFO

**可选值**:
- `0`: 必须完整读取FIFO (默认)
- `1`: 可以部分读取,从上次位置继续

#### FIFO_WM_GT_TH (bit 5)
**功能说明**: FIFO水印中断触发条件

**可选值**:
- `0`: 达到水印时触发一次
- `1`: 每次ODR时若FIFO_COUNT≥水印则触发

### 5.3 FIFO水印配置 (FIFO_CONFIG2/3, Bank0, 0x60-0x61)

#### FIFO_WM[11:0]
**功能说明**: 设置FIFO水印阈值

**数值范围**: 0-2048 (不要设为0)

**单位**: 根据FIFO_COUNT_REC设置
- FIFO_COUNT_REC=0: 字节数
- FIFO_COUNT_REC=1: 记录数

**效果说明**:
- 达到水印时可触发中断
- 用于批量读取,减少主机交互次数

### 5.4 FIFO接口配置 (INTF_CONFIG0, Bank0, 0x4C)

#### FIFO_COUNT_REC (bit 6)
**功能说明**: FIFO计数器单位

**可选值**:
- `0`: 以字节为单位报告
- `1`: 以记录为单位报告 (1记录=8/16/20字节)

#### FIFO_COUNT_ENDIAN (bit 5)
**功能说明**: FIFO计数字节序

**可选值**:
- `0`: 小端格式
- `1`: 大端格式 (默认)

#### FIFO_HOLD_LAST_DATA_EN (bit 7)
**功能说明**: 无效样本处理方式

**可选值**:
- `0`: 无效样本用特殊值标识 (如-32768)
- `1`: 无效样本复制上次有效样本

**效果说明**: 详见datasheet 12.8节

### 5.5 FIFO包结构

**包结构类型**:
1. **Packet 1**: 加速度计 (8字节: Header+Accel+Temp)
2. **Packet 2**: 陀螺仪 (8字节: Header+Gyro+Temp)
3. **Packet 3**: 六轴+时间戳 (16字节: Header+Accel+Gyro+Temp+TS)
4. **Packet 4**: 20位高分辨率 (20字节: Header+Accel+Gyro+Temp+TS+Ext)

**FIFO Header**:
- bit 7: HEADER_MSG (1=FIFO空)
- bit 6: HEADER_ACCEL (1=包含加速度计)
- bit 5: HEADER_GYRO (1=包含陀螺仪)
- bit 4: HEADER_20 (1=20位数据)
- bits 3:2: HEADER_TIMESTAMP_FSYNC (时间戳类型)
- bit 1: HEADER_ODR_ACCEL (加速度计ODR变化)
- bit 0: HEADER_ODR_GYRO (陀螺仪ODR变化)

### 5.6 FIFO容量

**物理容量**: 2048字节

**实际可用**: 最多2080字节 (包含读缓存)

**建议**: 驱动分配2080字节缓冲区

---

## 6. 中断配置

### 6.1 中断引脚配置 (INT_CONFIG, Bank0, 0x14)

#### INT1配置

##### INT1_POLARITY (bit 0)
**功能说明**: INT1引脚极性

**可选值**:
- `0`: 低电平有效 (默认)
- `1`: 高电平有效

##### INT1_DRIVE_CIRCUIT (bit 1)
**功能说明**: INT1输出类型

**可选值**:
- `0`: 开漏输出
- `1`: 推挽输出

##### INT1_MODE (bit 2)
**功能说明**: INT1中断模式

**可选值**:
- `0`: 脉冲模式
- `1`: 锁存模式

#### INT2配置 (bits 5:3)
同INT1,对应控制INT2引脚

**效果说明**:
- 开漏需要外部上拉电阻,可多个设备共享
- 推挽输出驱动能力强,不需外部电阻
- 脉冲模式自动清除,锁存模式需读状态寄存器清除

### 6.2 中断时序配置 (INT_CONFIG1, Bank0, 0x64)

#### INT_TPULSE_DURATION (bit 6)
**功能说明**: 中断脉冲宽度

**可选值**:
- `0`: 100μs脉冲,ODR<4kHz时使用 (默认)
- `1`: 8μs脉冲,ODR≥4kHz时必须使用

#### INT_TDEASSERT_DISABLE (bit 5)
**功能说明**: 中断去断言持续时间

**可选值**:
- `0`: 最小100μs去断言时间,ODR<4kHz时使用 (默认)
- `1`: 禁用去断言时间,ODR≥4kHz时必须使用

#### INT_ASYNC_RESET (bit 4)
**功能说明**: 异步复位控制

**可选值**:
- `0`: 建议设置 (正确的INT1/INT2操作)
- `1`: 默认值,应修改为0

### 6.3 中断源配置

#### 6.3.1 INT1中断源 (INT_SOURCE0, Bank0, 0x65)

##### UI_FSYNC_INT1_EN (bit 6)
**功能说明**: FSYNC中断路由到INT1

**可选值**: 0=不路由, 1=路由到INT1

##### PLL_RDY_INT1_EN (bit 5)
**功能说明**: PLL就绪中断路由到INT1

##### RESET_DONE_INT1_EN (bit 4)
**功能说明**: 复位完成中断路由到INT1

##### UI_DRDY_INT1_EN (bit 3)
**功能说明**: 数据就绪中断路由到INT1

##### FIFO_THS_INT1_EN (bit 2)
**功能说明**: FIFO水印中断路由到INT1

##### FIFO_FULL_INT1_EN (bit 1)
**功能说明**: FIFO满中断路由到INT1

##### UI_AGC_RDY_INT1_EN (bit 0)
**功能说明**: AGC就绪中断路由到INT1

#### 6.3.2 INT1运动中断源 (INT_SOURCE1, Bank0, 0x66)

##### SMD_INT1_EN (bit 3)
**功能说明**: 显著运动检测中断路由到INT1

##### WOM_Z/Y/X_INT1_EN (bits 2:0)
**功能说明**: X/Y/Z轴运动唤醒中断路由到INT1

#### 6.3.3 INT2中断源 (INT_SOURCE3/4, Bank0, 0x68-0x69)
配置同INT1,控制INT2引脚

#### 6.3.4 APEX中断源 (INT_SOURCE6/7, Bank4, 0x4D-0x4E)

可配置的APEX中断:
- STEP_DET_INT: 步数检测
- STEP_CNT_OFL_INT: 步数溢出
- TILT_DET_INT: 倾斜检测
- WAKE_DET_INT: 唤醒检测
- SLEEP_DET_INT: 睡眠检测
- TAP_DET_INT: 敲击检测

#### 6.3.5 I3C IBI中断源 (INT_SOURCE8-10, Bank4, 0x4F-0x51)
I3C模式下的带内中断配置

### 6.4 中断清除配置 (INT_CONFIG0, Bank0, 0x63)

#### UI_DRDY_INT_CLEAR (bits 5:4)
**功能说明**: 数据就绪中断清除方式 (锁存模式)

**可选值**:
- `00`: 读状态位清除 (默认)
- `01`: 读状态位清除
- `10`: 读传感器寄存器清除
- `11`: 读状态位且读传感器寄存器清除

#### FIFO_THS_INT_CLEAR (bits 3:2)
**功能说明**: FIFO水印中断清除方式

**可选值**:
- `00`: 读状态位清除 (默认)
- `01`: 读状态位清除
- `10`: 读FIFO数据1字节清除
- `11`: 读状态位且读FIFO数据清除

#### FIFO_FULL_INT_CLEAR (bits 1:0)
**功能说明**: FIFO满中断清除方式 (同上)

---

## 7. APEX运动功能

### 7.1 APEX功能总览 (APEX_CONFIG0, Bank0, 0x56)

#### DMP_POWER_SAVE (bit 7)
**功能说明**: DMP节能模式

**可选值**:
- `0`: 不激活节能模式
- `1`: 激活节能模式 (默认) - APEX功能仅在检测到WOM时使能

#### TAP_ENABLE (bit 6)
**功能说明**: 敲击检测使能

**可选值**:
- `0`: 敲击检测禁用
- `1`: 敲击检测使能 (需加速度计ODR为200Hz/500Hz/1kHz)

#### PED_ENABLE (bit 5)
**功能说明**: 计步器使能

**可选值**:
- `0`: 计步器禁用
- `1`: 计步器使能

#### TILT_ENABLE (bit 4)
**功能说明**: 倾斜检测使能

**可选值**:
- `0`: 倾斜检测禁用
- `1`: 倾斜检测使能

#### R2W_EN (bit 3)
**功能说明**: 抬起唤醒/睡眠手势检测使能

**可选值**:
- `0`: 手势检测禁用
- `1`: 手势检测使能

#### DMP_ODR (bits 1:0)
**功能说明**: DMP处理器的ODR设置

**可选值**:
| 设置值 | DMP ODR | 支持功能 |
|-------|---------|---------|
| `00` | 25 Hz | 低功耗模式 |
| `01` | 保留 | - |
| `10` | 50 Hz | 正常性能 |
| `11` | 保留 | - |

**APEX ODR支持总结**:
| 加速度计ODR | DMP_ODR | 敲击检测 | 计步器 | 倾斜 | 抬起唤醒/睡眠 |
|------------|---------|---------|-------|------|--------------|
| <25Hz | - | 禁用 | 禁用 | 禁用 | 禁用 |
| ≥25Hz | 0 (25Hz) | 禁用 | 低功耗 | 低功耗 | 使能 |
| ≥50Hz | 2 (50Hz) | 禁用 | 正常 | 正常 | 使能 |
| 200Hz | - | 低功耗 | - | - | - |
| 500Hz | - | 正常 | - | - | - |
| 1kHz | - | 高性能 | - | - | - |
| >1kHz | - | 禁用 | - | - | - |

**注意**: DMP_ODR必须是加速度计ODR的整数分频

### 7.2 运动唤醒(WOM)配置

#### 7.2.1 WOM模式 (SMD_CONFIG, Bank0, 0x57)

##### WOM_INT_MODE (bit 3)
**功能说明**: WOM中断触发逻辑

**可选值**:
- `0`: 任一轴超过阈值触发 (OR逻辑)
- `1`: 所有使能轴都超过阈值才触发 (AND逻辑)

##### WOM_MODE (bit 2)
**功能说明**: WOM比较模式

**可选值**:
- `0`: 与初始样本比较
- `1`: 与前一样本比较

##### SMD_MODE (bits 1:0)
**功能说明**: 显著运动检测模式

**可选值**:
- `00`: SMD禁用
- `01`: 保留
- `10`: SMD短时间 (1秒间隔检测2次WOM)
- `11`: SMD长时间 (3秒间隔检测2次WOM)

#### 7.2.2 WOM阈值 (Bank4, 0x4A-0x4C)

##### ACCEL_WOM_X/Y/Z_THR
**功能说明**: 设置X/Y/Z轴的WOM检测阈值

**数值范围**: 0-255

**分辨率**: 1g/256 ≈ 3.9mg

**效果说明**:
- 阈值越小,越灵敏,但易误触发
- 阈值越大,降低灵敏度
- 固定mg单位,与量程选择无关
- 建议值: 98 (约382mg)

### 7.3 计步器配置 (Bank4寄存器)

#### 主要配置参数:

##### LOW_ENERGY_AMP_TH_SEL (0x40, bits 7:4)
**默认值**: 10 (0xA)
**功能**: 低能量模式幅度阈值

##### PED_AMP_TH_SEL (0x41, bits 7:4)
**默认值**: 8
**功能**: 计步幅度阈值

##### PED_STEP_CNT_TH_SEL (0x41, bits 3:0)
**默认值**: 5
**功能**: 步数检测窗口 (0-15步)

##### PED_STEP_DET_TH_SEL (0x42, bits 7:5)
**默认值**: 2 (010b)
**功能**: 步数检测阈值 (0-7步)

##### PED_SB_TIMER_TH_SEL (0x42, bits 4:2)
**默认值**: 4 (100b)
**功能**: 步数缓冲定时器阈值 (0-7样本)

##### PED_HI_EN_TH_SEL (0x42, bits 1:0)
**默认值**: 1 (01b)
**功能**: 高能量阈值选择

##### SENSITIVITY_MODE (0x48, bit 0)
**功能说明**: 灵敏度模式选择

**可选值**:
- `0`: 25Hz时低功耗,≥50Hz时高性能
- `1`: 25Hz时低功耗+慢走,≥50Hz时慢走模式

#### 输出寄存器:
- STEP_CNT[15:0] (Bank0, 0x31-0x32): 步数计数
- STEP_CADENCE (Bank0, 0x33): 步频 (u6.2格式)
- ACTIVITY_CLASS (Bank0, 0x34, bits 1:0): 活动类型 (00=未知,01=走,10=跑)

### 7.4 倾斜检测配置

#### TILT_WAIT_TIME_SEL (Bank4, 0x43, bits 7:6)
**功能说明**: 倾斜检测后触发中断的延迟时间

**可选值**:
| 设置值 | 延迟时间 |
|-------|---------|
| `00` | 0秒 |
| `01` | 2秒 |
| `10` | 4秒 (默认) |
| `11` | 6秒 |

**效果说明**: 倾斜角度超过35°并持续该时间后触发中断

### 7.5 抬起唤醒/睡眠配置

#### SLEEP_TIME_OUT (Bank4, 0x43, bits 5:3)
**功能说明**: 睡眠检测的超时时间

**可选值**:
| 设置值 | 超时时间 |
|-------|---------|
| `000` | 1.28秒 |
| `001` | 2.56秒 |
| `010` | 3.84秒 |
| `011` | 5.12秒 |
| `100` | 6.40秒 |
| `101` | 7.68秒 |
| `110` | 8.96秒 |
| `111` | 10.24秒 |

#### MOUNTING_MATRIX (Bank4, 0x44, bits 2:0)
**功能说明**: 定义芯片坐标系到设备坐标系的安装矩阵

**可选值**: 000-111 (8种常见安装方向)

#### SLEEP_GESTURE_DELAY (Bank4, 0x45, bits 2:0)
**功能说明**: 睡眠手势检测窗口

**可选值**:
| 设置值 | 检测窗口 |
|-------|---------|
| `000` | 0.32秒 |
| `001` | 0.64秒 |
| `010` | 0.96秒 |
| `011` | 1.28秒 |
| `100` | 1.60秒 |
| `101` | 1.92秒 |
| `110` | 2.24秒 |
| `111` | 2.56秒 |

### 7.6 敲击检测配置

#### TAP_MIN_JERK_THR (Bank4, 0x46, bits 7:2)
**默认值**: 17 (010001b)
**功能**: 最小加加速度阈值

#### TAP_MAX_PEAK_TOL (Bank4, 0x46, bits 1:0)
**默认值**: 1 (01b)
**功能**: 最大峰值容差

#### TAP_TMAX (Bank4, 0x47, bits 6:5)
**默认值**: 1 (01b)
**功能**: 敲击测量窗口 (样本数)

#### TAP_TAVG (Bank4, 0x47, bits 4:3)
**默认值**: 1 (01b)
**功能**: 敲击能量测量窗口 (样本数)

#### TAP_TMIN (Bank4, 0x47, bits 2:0)
**默认值**: 3 (011b)
**功能**: 单击窗口 (样本数)

#### 输出寄存器:
- TAP_NUM (Bank0, 0x35, bits 4:3): 敲击次数 (00=无,01=单击,10=双击)
- TAP_AXIS (Bank0, 0x35, bits 2:1): 敲击轴 (00=X,01=Y,10=Z)
- TAP_DIR (Bank0, 0x35, bit 0): 敲击方向
- DOUBLE_TAP_TIMING (Bank0, 0x36, bits 5:0): 双击时间间隔

**效果说明**: 时间(秒) = DOUBLE_TAP_TIMING × 16 / ODR

### 7.7 DMP节能时间配置

#### DMP_POWER_SAVE_TIME_SEL (Bank4, 0x40, bits 3:0)
**功能说明**: DMP节能模式唤醒后的保持时间

**可选值**: 0000-1111 (0-60秒,每步4秒)

---

## 8. 接口配置

### 8.1 传感器轴禁用 (SENSOR_CONFIG0, Bank1, 0x03)

#### 陀螺仪轴禁用
**功能说明**: 独立禁用陀螺仪的X/Y/Z轴

- **ZG_DISABLE** (bit 5): 0=Z轴使能, 1=Z轴禁用
- **YG_DISABLE** (bit 4): 0=Y轴使能, 1=Y轴禁用
- **XG_DISABLE** (bit 3): 0=X轴使能, 1=X轴禁用

#### 加速度计轴禁用
**功能说明**: 独立禁用加速度计的X/Y/Z轴

- **ZA_DISABLE** (bit 2): 0=Z轴使能, 1=Z轴禁用
- **YA_DISABLE** (bit 1): 0=Y轴使能, 1=Y轴禁用
- **XA_DISABLE** (bit 0): 0=X轴使能, 1=X轴禁用

**效果说明**:
- 可用于降低功耗(只使用需要的轴)
- 禁用的轴数据寄存器不更新
- 二轴应用可禁用第三轴

### 8.2 软件复位 (DEVICE_CONFIG, Bank0, 0x11)

#### SOFT_RESET_CONFIG (bit 0)
**功能说明**: 软件复位控制

**可选值**:
- `0`: 正常工作 (默认)
- `1`: 触发软件复位

**效果说明**:
- 写1触发复位,恢复所有寄存器到默认值
- 复位后等待1ms才能访问寄存器
- 等效于断电重启

### 8.3 接口选择 (INTF_CONFIG0, Bank0, 0x4C)

#### UI_SIFS_CFG (bits 1:0)
**功能说明**: 禁用串行接口

**可选值**:
| 设置值 | 效果 |
|-------|------|
| `0x` | 保留 |
| `10` | 禁用SPI |
| `11` | 禁用I2C |

**注意**: 上电默认SPI模式,需配置以使用I2C/I3C

### 8.4 SPI配置

#### 8.4.1 SPI模式选择 (DEVICE_CONFIG, Bank0, 0x11)

##### SPI_MODE (bit 4)
**功能说明**: SPI时钟相位和极性选择

**可选值**:
- `0`: Mode 0和Mode 3 (默认)
- `1`: Mode 1和Mode 2

#### 8.4.2 SPI线数 (INTF_CONFIG4, Bank1, 0x7A)

##### SPI_AP_4WIRE (bit 1)
**功能说明**: SPI线数选择

**可选值**:
- `0`: 3线SPI模式
- `1`: 4线SPI模式 (默认)

**效果说明**:
- 4线: SCLK, CS, SDI, SDO
- 3线: SCLK, CS, SDIO (双向数据线)

#### 8.4.3 SPI速率
**最高速率**: 24 MHz

### 8.5 I2C配置

#### 8.5.1 I2C地址
**地址格式**: 1101000x (7位)

**AP_ADO引脚**:
- AP_ADO=0: 地址0x68 (1101000)
- AP_ADO=1: 地址0x69 (1101001)

**效果说明**: 允许两个ICM42688P共享同一I2C总线

#### 8.5.2 I2C速率
**最高速率**: 1 MHz (Fast-Mode Plus)

#### 8.5.3 I2C驱动强度 (DRIVE_CONFIG, Bank0, 0x13)

##### I2C_SLEW_RATE (bits 5:3)
**功能说明**: 控制I2C模式下引脚14的输出转换速率

**可选值**:
| 设置值 | 转换速率 |
|-------|---------|
| `000` | 20ns-60ns |
| `001` | 12ns-36ns |
| `010` | 6ns-18ns |
| `011` | 4ns-12ns |
| `100` | 2ns-6ns |
| `101` | < 2ns |
| `110-111` | 保留 |

### 8.6 I3C配置

#### 8.6.1 I3C使能 (INTF_CONFIG6, Bank1, 0x7C)

##### I3C_EN (bit 4)
**功能说明**: I3C从机使能

**可选值**:
- `0`: I3C从机禁用
- `1`: I3C从机使能

##### I3C_SDR_EN (bit 0)
**功能说明**: I3C SDR模式使能

**可选值**:
- `0`: SDR模式禁用
- `1`: SDR模式使能 (最高12.5Mbps)

##### I3C_DDR_EN (bit 1)
**功能说明**: I3C DDR模式使能

**可选值**:
- `0`: DDR模式禁用
- `1`: DDR模式使能 (最高25Mbps)

#### 8.6.2 I3C带内中断(IBI)

##### I3C_IBI_EN (bit 2)
**功能说明**: IBI功能使能

**可选值**:
- `0`: IBI禁用
- `1`: IBI使能

##### I3C_IBI_BYTE_EN (bit 3)
**功能说明**: IBI数据有效载荷功能

**可选值**:
- `0`: 不使能IBI数据
- `1`: 使能IBI数据

#### 8.6.3 I3C总线模式 (INTF_CONFIG4, Bank1, 0x7A)

##### I3C_BUS_MODE (bit 6)
**功能说明**: I3C总线类型

**可选值**:
- `0`: 总线上有I2C和I3C设备
- `1`: 总线上仅有I3C设备

#### 8.6.4 I3C异步时序

##### ASYNCTIMEO_DIS (INTF_CONFIG6, Bank1, 0x7C, bit 7)
**功能说明**: I3C异步模式0时序控制

**可选值**:
- `0`: 时序控制使能
- `1`: 时序控制禁用

### 8.7 通用输出驱动配置

#### SPI_SLEW_RATE (DRIVE_CONFIG, Bank0, 0x13, bits 2:0)
**功能说明**: 控制SPI或I3C模式下所有输出引脚的转换速率

**可选值**: 同I2C_SLEW_RATE

### 8.8 数据格式配置

#### SENSOR_DATA_ENDIAN (INTF_CONFIG0, Bank0, 0x4C, bit 4)
**功能说明**: 传感器数据字节序

**可选值**:
- `0`: 小端格式
- `1`: 大端格式 (默认)

---

## 9. 时钟配置

### 9.1 时钟源选择 (INTF_CONFIG1, Bank0, 0x4D)

#### CLKSEL (bits 1:0)
**功能说明**: 选择内部时钟源

**可选值**:
| 设置值 | 时钟源 |
|-------|--------|
| `00` | 始终使用内部RC振荡器 |
| `01` | PLL可用时用PLL,否则用RC (默认) |
| `10` | 保留 |
| `11` | 禁用所有时钟 |

**效果说明**:
- RC振荡器: 精度低,但功耗低
- PLL: 精度高(±1%),但需陀螺仪开启
- 建议使用默认设置01

**时钟频率容差**:
| 模式 | 温度 | 初始容差 | 温度漂移 |
|------|------|---------|---------|
| RC或陀螺OFF | 25°C | ±3% | ±3% |
| PLL(陀螺ON) | 25°C | ±1.5% | ±2% |

### 9.2 外部时钟输入 (RTC/CLKIN)

#### 9.2.1 RTC模式使能 (INTF_CONFIG1, Bank0, 0x4D)

##### RTC_MODE (bit 2)
**功能说明**: 外部RTC时钟输入使能

**可选值**:
- `0`: 不需要外部RTC时钟
- `1`: 需要外部RTC时钟输入

#### 9.2.2 引脚9功能选择 (INTF_CONFIG5, Bank1, 0x7B)

##### PIN9_FUNCTION (bits 2:1)
**功能说明**: 选择引脚9的功能

**可选值**:
| 设置值 | 功能 |
|-------|------|
| `00` | INT2 |
| `01` | FSYNC |
| `10` | CLKIN (外部时钟输入) |
| `11` | 保留 |

#### 9.2.3 外部时钟规格

**频率范围**: 31kHz - 50kHz
**典型值**: 32kHz或32.768kHz

**效果说明**:
- 提高ODR精度 (可达±50ppm,外部晶振精度)
- 减少系统级灵敏度误差
- 改善陀螺仪方向测量
- 降低ODR温度灵敏度
- 简化传感器与主机时钟同步

**注意**: 使用外部时钟时,ODR值会按比例缩放
公式: 实际ODR = 标称ODR × (外部时钟频率 / 32kHz)

### 9.3 加速度计LP模式时钟

#### ACCEL_LP_CLK_SEL (INTF_CONFIG1, Bank0, 0x4D, bit 3)
**功能说明**: 加速度计LP模式时钟源选择

**可选值**:
- `0`: 使用唤醒振荡器
- `1`: 使用RC振荡器

---

## 10. 温度传感器配置

### 10.1 温度传感器使能

参见 **1.1 电源管理** 中的TEMP_DIS配置

### 10.2 温度传感器滤波器

参见 **4.5 温度传感器滤波器** 中的TEMP_FILT_BW配置

### 10.3 温度数据读取

#### 温度数据寄存器
- TEMP_DATA1 (Bank0, 0x1D): 高字节
- TEMP_DATA0 (Bank0, 0x1E): 低字节

#### 数据更新率
**更新频率**: max(加速度计ODR, 陀螺仪ODR)

#### 温度转换公式

**传感器寄存器数据**:
```
温度(°C) = TEMP_DATA / 132.48 + 25
```

**FIFO数据** (8位):
```
温度(°C) = FIFO_TEMP_DATA / 2.07 + 25
```

### 10.4 温度规格

**分辨率**: 16位 (寄存器), 8位 (FIFO)
**工作范围**: -40°C 至 +85°C
**室温偏移**: -5°C 至 +5°C
**灵敏度**: 132.48 LSB/°C (寄存器), 2.07 LSB/°C (FIFO)
**稳定时间**: 最大14ms

---

## 11. 用户偏移量配置

### 11.1 陀螺仪偏移 (Bank4, 0x77-0x7B)

#### GYRO_X/Y/Z_OFFUSER[11:0]
**功能说明**: 用户可编程的陀螺仪偏移量,每轴独立

**寄存器分布**:
- X轴: OFFSET_USER0[7:0] + OFFSET_USER1[3:0]
- Y轴: OFFSET_USER1[7:4] + OFFSET_USER2[7:0]
- Z轴: OFFSET_USER3[7:0] + OFFSET_USER4[3:0]

**数值范围**: ±64 dps
**分辨率**: 1/32 dps = 0.03125 dps

**效果说明**: 用于补偿陀螺仪的零偏,提高精度

**使用方法**:
1. 静止状态采集N个样本
2. 计算平均值作为零偏
3. 将零偏值写入偏移寄存器
4. 后续读数会自动减去该偏移

### 11.2 加速度计偏移 (Bank4, 0x7B-0x7F)

#### ACCEL_X/Y/Z_OFFUSER[11:0]
**功能说明**: 用户可编程的加速度计偏移量,每轴独立

**寄存器分布**:
- X轴: OFFSET_USER4[7:4] + OFFSET_USER5[7:0]
- Y轴: OFFSET_USER6[7:0] + OFFSET_USER7[3:0]
- Z轴: OFFSET_USER7[7:4] + OFFSET_USER8[7:0]

**数值范围**: ±1 g
**分辨率**: 0.5 mg

**效果说明**: 用于补偿加速度计的零偏和增益误差

---

## 12. 自检配置

### 12.1 自检使能 (SELF_TEST_CONFIG, Bank0, 0x70)

#### EN_GX/GY/GZ_ST (bits 2:0)
**功能说明**: 使能X/Y/Z轴陀螺仪自检

**可选值**: 0=禁用, 1=使能

#### EN_AX/AY/AZ_ST (bits 5:3)
**功能说明**: 使能X/Y/Z轴加速度计自检

**可选值**: 0=禁用, 1=使能

#### ACCEL_ST_POWER (bit 6)
**功能说明**: 加速度计自检电源控制

**可选值**:
- `0`: 正常工作
- `1`: 加速度计自检模式

**效果说明**: 执行加速度计自检时设为1,完成后设回0

### 12.2 自检过程

1. 读取自检禁用时的传感器输出
2. 使能自检
3. 读取自检使能时的传感器输出
4. 计算自检响应 = 使能输出 - 禁用输出
5. 对比自检响应与规格限值
6. 禁用自检

### 12.3 自检参考数据

**陀螺仪自检数据** (Bank1, 0x5F-0x61):
- XG_ST_DATA: X轴
- YG_ST_DATA: Y轴
- ZG_ST_DATA: Z轴

**加速度计自检数据** (Bank2, 0x3B-0x3D):
- XA_ST_DATA: X轴
- YA_ST_DATA: Y轴
- ZA_ST_DATA: Z轴

**效果说明**: 工厂校准的自检响应值,用于对比

---

## 13. FSYNC配置

### 13.1 FSYNC基本配置 (FSYNC_CONFIG, Bank0, 0x62)

#### FSYNC_UI_SEL (bits 6:4)
**功能说明**: 选择FSYNC标志映射到哪个传感器输出的LSB

**可选值**:
| 设置值 | FSYNC标志位置 |
|-------|-------------|
| `000` | 不标记FSYNC |
| `001` | TEMP_OUT LSB |
| `010` | GYRO_XOUT LSB |
| `011` | GYRO_YOUT LSB |
| `100` | GYRO_ZOUT LSB |
| `101` | ACCEL_XOUT LSB |
| `110` | ACCEL_YOUT LSB |
| `111` | ACCEL_ZOUT LSB |

**效果说明**: FSYNC标志占用数据LSB,该位数据精度降低1位

#### FSYNC_POLARITY (bit 0)
**功能说明**: FSYNC脉冲极性选择

**可选值**:
- `0`: 从上升沿开始测量FSYNC间隔
- `1`: 从下降沿开始测量FSYNC间隔

#### FSYNC_UI_FLAG_CLEAR_SEL (bit 1)
**功能说明**: FSYNC标志清除方式

**可选值**:
- `0`: 传感器寄存器更新时清除标志
- `1`: UI接口读取被标记传感器的LSB时清除

### 13.2 FSYNC时间戳

#### 时间戳寄存器
- TMST_FSYNCH (Bank0, 0x2B): 高字节
- TMST_FSYNCL (Bank0, 0x2C): 低字节

**功能说明**: 存储从FSYNC上升沿到最近一次ODR的时间差

**数据有效期**: 直到读取状态寄存器中的FSYNC标志

### 13.3 FIFO中的FSYNC

#### FIFO_TMST_FSYNC_EN (FIFO_CONFIG1, Bank0, 0x5F, bit 3)
**功能说明**: 使能FSYNC时间和标志写入FIFO

**可选值**:
- `0`: FIFO仅包含ODR时间戳
- `1`: FIFO可包含FSYNC时间和标志

**效果说明**: 使用FSYNC时必须设为1

---

## 14. 时间戳配置

### 14.1 时间戳使能 (TMST_CONFIG, Bank0, 0x54)

#### TMST_EN (bit 0)
**功能说明**: 时间戳寄存器使能

**可选值**:
- `0`: 禁用时间戳
- `1`: 使能时间戳 (默认)

#### TMST_TO_REGS_EN (bit 4)
**功能说明**: 时间戳值读取使能

**可选值**:
- `0`: TMST_VALUE[19:0]读取始终返回0
- `1`: TMST_VALUE[19:0]读取返回实际时间戳

### 14.2 时间戳分辨率 (TMST_CONFIG, Bank0, 0x54)

#### TMST_RES (bit 3)
**功能说明**: 时间戳分辨率选择

**可选值**:
| RTC模式 | TMST_RES | 分辨率 |
|---------|----------|--------|
| RTC禁用 | 0 | 1 μs (默认) |
| RTC禁用 | 1 | 16 μs |
| RTC使能 | 0 | 1 μs |
| RTC使能 | 1 | 1个RTC时钟周期 |

**效果说明**: 
- 使用外部时钟时,分辨率更稳定
- 详见datasheet 12.7节关于时间戳缩放的补充说明

### 14.3 时间戳模式 (TMST_CONFIG, Bank0, 0x54)

#### TMST_DELTA_EN (bit 2)
**功能说明**: 时间戳增量模式

**可选值**:
- `0`: 时间戳为绝对时间
- `1`: 时间戳为自上次ODR以来的时间差

#### TMST_FSYNC_EN (bit 1)
**功能说明**: FSYNC时间戳功能使能

**可选值**:
- `0`: 禁用FSYNC时间戳
- `1`: 使能FSYNC时间戳 (默认)

**效果说明**: 使能后,TMST_FSYNC寄存器记录FSYNC事件时间

### 14.4 时间戳手动捕获

#### TMST_STROBE (SIGNAL_PATH_RESET, Bank0, 0x4B, bit 2)
**功能说明**: 手动触发时间戳捕获

**可选值**:
- `0`: 正常
- `1`: 将当前时间戳锁存到TMSTVAL寄存器

**效果说明**: 写1后自动清零

### 14.5 时间戳读取寄存器

**TMSTVAL寄存器** (Bank1, 0x62-0x64):
- TMSTVAL0: bits [7:0]
- TMSTVAL1: bits [15:8]
- TMSTVAL2: bits [19:16]

**功能说明**: 存储锁存的完整20位时间戳值

---

## 附录A: 寄存器快速索引

### Bank 0 主要寄存器
| 地址 | 名称 | 功能 |
|-----|------|------|
| 0x11 | DEVICE_CONFIG | 设备配置 |
| 0x13 | DRIVE_CONFIG | 驱动强度 |
| 0x14 | INT_CONFIG | 中断配置 |
| 0x16 | FIFO_CONFIG | FIFO模式 |
| 0x4C | INTF_CONFIG0 | 接口配置0 |
| 0x4D | INTF_CONFIG1 | 接口配置1 |
| 0x4E | PWR_MGMT0 | 电源管理 |
| 0x4F | GYRO_CONFIG0 | 陀螺仪配置 |
| 0x50 | ACCEL_CONFIG0 | 加速度计配置 |
| 0x51 | GYRO_CONFIG1 | 陀螺仪滤波器 |
| 0x52 | GYRO_ACCEL_CONFIG0 | 滤波器带宽 |
| 0x53 | ACCEL_CONFIG1 | 加速度计滤波器 |
| 0x54 | TMST_CONFIG | 时间戳配置 |
| 0x56 | APEX_CONFIG0 | APEX功能 |
| 0x57 | SMD_CONFIG | WOM配置 |
| 0x5F | FIFO_CONFIG1 | FIFO内容 |
| 0x60-0x61 | FIFO_CONFIG2/3 | FIFO水印 |
| 0x62 | FSYNC_CONFIG | FSYNC配置 |
| 0x63 | INT_CONFIG0 | 中断清除 |
| 0x64 | INT_CONFIG1 | 中断时序 |
| 0x65-0x66 | INT_SOURCE0/1 | INT1中断源 |
| 0x68-0x69 | INT_SOURCE3/4 | INT2中断源 |
| 0x70 | SELF_TEST_CONFIG | 自检配置 |
| 0x75 | WHO_AM_I | 设备ID (0x47) |
| 0x76 | REG_BANK_SEL | 寄存器组选择 |

### Bank 1 主要寄存器
| 地址 | 名称 | 功能 |
|-----|------|------|
| 0x03 | SENSOR_CONFIG0 | 传感器禁用 |
| 0x0B | GYRO_CONFIG_STATIC2 | AAF/NF使能 |
| 0x0C-0x0E | GYRO_CONFIG_STATIC3-5 | 陀螺AAF参数 |
| 0x0F-0x12 | GYRO_CONFIG_STATIC6-9 | 陀螺NF参数 |
| 0x13 | GYRO_CONFIG_STATIC10 | 陀螺NF带宽 |
| 0x7A | INTF_CONFIG4 | SPI模式 |
| 0x7B | INTF_CONFIG5 | 引脚9功能 |
| 0x7C | INTF_CONFIG6 | I3C配置 |

### Bank 2 主要寄存器
| 地址 | 名称 | 功能 |
|-----|------|------|
| 0x03-0x05 | ACCEL_CONFIG_STATIC2-4 | 加速度计AAF |

### Bank 4 主要寄存器
| 地址 | 名称 | 功能 |
|-----|------|------|
| 0x40-0x48 | APEX_CONFIG1-9 | APEX参数 |
| 0x4A-0x4C | ACCEL_WOM_X/Y/Z_THR | WOM阈值 |
| 0x4D-0x4E | INT_SOURCE6/7 | APEX中断源 |
| 0x77-0x7F | OFFSET_USER0-8 | 用户偏移量 |

---

## 附录B: 典型配置场景

### B.1 低功耗姿态检测
```
PWR_MGMT0: ACCEL_MODE=10 (LP), GYRO_MODE=00 (OFF)
ACCEL_CONFIG0: ACCEL_FS_SEL=011 (±2g), ACCEL_ODR=1010 (25Hz)
GYRO_ACCEL_CONFIG0: ACCEL_UI_FILT_BW=6 (16x平均)
FIFO_CONFIG: FIFO_MODE=00 (Bypass)
INT_CONFIG: INT1配置为推挽,高电平有效
INT_SOURCE0: UI_DRDY_INT1_EN=1
```

### B.2 高性能六轴跟踪
```
PWR_MGMT0: ACCEL_MODE=11 (LN), GYRO_MODE=11 (LN)
ACCEL_CONFIG0: ACCEL_FS_SEL=010 (±4g), ACCEL_ODR=0110 (1kHz)
GYRO_CONFIG0: GYRO_FS_SEL=000 (±2000dps), GYRO_ODR=0110 (1kHz)
GYRO_ACCEL_CONFIG0: ACCEL_UI_FILT_BW=1, GYRO_UI_FILT_BW=1
FIFO_CONFIG: FIFO_MODE=01 (Stream-to-FIFO)
FIFO_CONFIG1: FIFO_GYRO_EN=1, FIFO_ACCEL_EN=1, FIFO_TMST_FSYNC_EN=1
FIFO_CONFIG2/3: FIFO_WM=512字节
INT_SOURCE0: FIFO_THS_INT1_EN=1
```

### B.3 计步器应用
```
PWR_MGMT0: ACCEL_MODE=10 (LP), GYRO_MODE=00 (OFF)
ACCEL_CONFIG0: ACCEL_ODR=1001 (50Hz)
APEX_CONFIG0: PED_ENABLE=1, DMP_ODR=10 (50Hz), DMP_POWER_SAVE=0
APEX_CONFIG1-3: 使用默认值
INT_SOURCE6: STEP_DET_INT1_EN=1
```

### B.4 敲击检测
```
PWR_MGMT0: ACCEL_MODE=10 (LP), GYRO_MODE=00 (OFF)
ACCEL_CONFIG0: ACCEL_ODR=1111 (500Hz), ACCEL_FS_SEL=011 (±2g)
GYRO_ACCEL_CONFIG0: ACCEL_UI_FILT_BW=4
ACCEL_CONFIG1: ACCEL_DEC2_M2_ORD=10, ACCEL_UI_FILT_ORD=10
APEX_CONFIG0: TAP_ENABLE=1
APEX_CONFIG7: TAP_MIN_JERK_THR=17, TAP_MAX_PEAK_TOL=1
APEX_CONFIG8: TAP_TMAX=2, TAP_TMIN=3, TAP_TAVG=3
INT_SOURCE6: TAP_DET_INT1_EN=1
```

---

## 附录C: 注意事项与最佳实践

### C.1 电源管理
1. 从OFF模式切换到其他模式后,等待200μs再进行寄存器操作
2. 陀螺仪需保持开启至少45ms
3. 加速度计启动时间约10ms

### C.2 模式切换
1. LN↔LP模式切换时注意ODR支持范围
2. LP模式不支持>500Hz的ODR
3. LN模式不支持<12.5Hz的ODR

### C.3 滤波器使用
1. AAF和NF仅在LN模式下有效
2. 修改滤波器前需关闭传感器
3. LP模式建议使用16x平均滤波

### C.4 FIFO使用
1. FIFO驱动建议分配2080字节缓冲区
2. 不要将FIFO_WM设为0
3. 使用FSYNC时必须设置FIFO_TMST_FSYNC_EN=1

### C.5 中断配置
1. 建议将INT_ASYNC_RESET设为0
2. ODR≥4kHz时必须调整INT_TPULSE_DURATION和INT_TDEASSERT_DISABLE
3. 锁存模式需要读状态寄存器清除中断

### C.6 APEX功能
1. DMP_ODR必须是加速度计ODR的整数分频
2. 修改DMP_ODR前需禁用APEX功能,修改后重新初始化
3. 计步器需至少25Hz加速度计ODR
4. 敲击检测需200Hz/500Hz/1kHz ODR

### C.7 寄存器操作
1. 除ODR、FSR、MODE外,其他寄存器需在传感器关闭时修改
2. 修改Bank前先读取REG_BANK_SEL确认当前Bank
3. 某些寄存器有工厂校准值,不要修改保留位

### C.8 外部时钟
1. 使用外部时钟时,实际ODR会缩放
2. 外部时钟可大幅提高ODR精度(±50ppm vs ±3%)
3. 时间戳缩放规则见datasheet 12.7节

---

## 文档修订记录

**版本**: 1.0
**日期**: 2024
**基于**: ICM-42688-P Datasheet Rev 1.8 (2023-07-27)

**修订说明**:
- 初始版本
- 整理了ICM-42688-P的所有可配置参数
- 包含详细的寄存器说明、可选值和效果说明
- 添加了典型配置场景和最佳实践

---

**使用建议**:
1. 开发前先阅读相关章节,了解可配置项
2. 对照寄存器快速索引找到对应寄存器地址
3. 参考典型配置场景快速搭建应用
4. 注意事项章节包含重要的使用限制

**进一步参考**:
- 完整寄存器描述见原datasheet第13-18章
- 信号路径详细配置见datasheet第5章
- APEX算法细节见datasheet第8章

